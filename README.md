# CUPK教务系统脚本

## 概述

本项目包含四个 Python 脚本，用于与大学教务系统（例如 http://jw.cupk.edu.cn）进行交互：

1.  `cjcx.py` (成绩查询脚本): 自动登录教务系统，获取学生成绩，与上次查询的成绩进行比较，并在成绩有更新时通过 PushPlus 推送通知。
2.  `jw.py` (课表查询脚本): 自动登录教务系统，获取当日或者明日的课表，并通过 PushPlus 推送通知。
3.  `pj.py` (自动评教脚本): 自动登录教务系统，查找所有需要评价的课程，并自动为所有评教项选择"A"（或其他预设等级），然后提交评教。
4.  `kstx.py` (考试提醒脚本): 自动登录教务系统，获取当前学期的考试安排，按日期排序，并在有一周内的考试时通过 PushPlus 推送提醒。

## 功能特性

### 通用功能
*   自动登录教务系统。

### `cjcx.py` (成绩查询脚本)
*   获取所有学期的成绩。
*   通过 PushPlus 发送通知。
*   将当前获取的成绩与本地存储的先前成绩 (`previous_grades_data.json`) 进行比较。
*   仅当成绩发生变化时才发送推送通知。
*   自动保存最新成绩到本地文件。

### `jw.py` (课表查询脚本)
*   获取指定周的课表 (默认为当前周)。
*   通过 PushPlus 发送通知。
*   根据运行时间推送课表：
    *   北京时间20点前运行，推送当日课表。
    *   北京时间20点后运行，推送次日课表。
*   在控制台打印将要推送的课表信息。
*   需要手动在脚本中配置学期的第一周周一日期 (`first_week_monday`)。

### `pj.py` (自动评教脚本)
*   自动访问评教页面。
*   解析需要评教的课程列表。
*   过滤出未提交评教的课程。
*   自动为所有评教问题选择"A"选项 (可配置)。
*   自动提交评教表单。
*   提供详细的操作状态和结果反馈。

### `kstx.py` (考试提醒脚本)
*   获取并解析当前学期考试安排。
*   按日期对考试进行排序。
*   智能判断：只有在有一周内考试时才推送微信提醒。
*   突出显示一周内即将到来的考试。
*   计算每门考试距今的剩余天数。
*   美观的HTML表格格式展示考试信息。
*   颜色区分不同状态的考试（已结束、即将进行、近期）。

## 先决条件

*   Python 3.6 或更高版本
*   必要的 Python 库 (已包含在 `requirements.txt` 中):
    *   `requests`: 用于HTTP请求
    *   `beautifulsoup4`: 用于HTML解析
    *   `datetime`: 用于日期时间处理
    *   `re` (内置库，无需额外安装): 用于正则表达式处理

## 安装与配置

1.  **获取脚本**:
    *   克隆本仓库或直接下载 `cjcx.py`, `jw.py`, `pj.py` 和 `kstx.py` 文件。

2.  **安装依赖**:
    *   使用项目根目录中的 `requirements.txt` 文件安装所有必要的依赖:
        ```bash
        pip install -r requirements.txt
        ```

3.  **环境变量配置**:
    *   为了安全地管理您的凭据和令牌，请设置以下环境变量：
        *   `JW_USERNAME`: 您的教务系统学号 (所有脚本均需)。
        *   `JW_PASSWORD`: 您的教务系统密码 (所有脚本均需)。
        *   `PUSH_TOKEN`: 您的 PushPlus 令牌 (用于 `cjcx.py` 和 `jw.py` 接收通知)。

4.  **脚本特定配置**:
    *   **`cjcx.py`**:
        *   `previous_grades_data.json`: 此文件由脚本自动创建和管理，用于存储上一次查询的成绩。无需手动配置。
    *   **`jw.py`**:
        *   `first_week_monday`: 打开 `jw.py` 文件，找到 `JWSystem` 类中的 `self.first_week_monday` 变量。根据您当前学期的实际开学第一周的周一日期修改它。例如：
            ```python
            self.first_week_monday = datetime(2025, 3, 3) # 修改为实际日期
            ```
    *   **`pj.py`**:
        *   默认所有评教题目均选择"A"选项。
        *   除了环境变量，您也可以选择直接在 `pj.py` 代码中设置用户名和密码 (详见脚本内注释)。

## 使用方法

1.  **手动运行脚本**:
    *   确保已完成安装与配置步骤。
    *   打开终端或命令提示符，导航到脚本所在的目录。
    *   运行成绩查询脚本：
        ```bash
        python cjcx.py
        ```
    *   运行课表查询脚本：
        ```bash
        python jw.py
        ```
    *   运行自动评教脚本：
        *   如果已设置环境变量 `JW_USERNAME` 和 `JW_PASSWORD`:
            ```bash
            python pj.py
            ```
        *   如果选择在代码中直接修改凭据，请先按 `pj.py` 中说明修改后再运行。
    *   运行考试提醒脚本：
        ```bash
        python kstx.py
        ```
        *   注意：只有检测到一周内有考试时，才会推送微信提醒。

2.  **设置定时任务 (可选)**:
    *   您可以为 `cjcx.py` (成绩查询)、`jw.py` (课表查询) 和 `kstx.py` (考试提醒) 设置定时任务，让脚本定期自动运行。
    *   **Windows**: 可以使用 "任务计划程序 (Task Scheduler)"。
        *   例如，设置每30分钟运行一次 `cjcx.py`：
            *   触发器：每隔30分钟。
            *   操作：启动程序，程序或脚本填写 `python`，添加参数填写 `c:\path\to\your\script\cjcx.py` (替换为实际路径)。
        *   对于 `kstx.py`，建议设置为每天运行一次，例如早上8点：
            *   触发器：每天，时间为08:00:00。
            *   操作：启动程序，程序或脚本填写 `python`，添加参数填写 `c:\path\to\your\script\kstx.py`。
    *   **Linux/macOS**: 可以使用 `cron`。
        *   例如，设置每30分钟运行一次 `cjcx.py`：
            *   打开 crontab 编辑器: `crontab -e`
            *   添加一行: `*/30 * * * * /usr/bin/python3 /path/to/your/script/cjcx.py` (替换为实际 Python 解释器路径和脚本路径)。
        *   对于 `kstx.py`，可以添加：
            *   `0 8 * * * /usr/bin/python3 /path/to/your/script/kstx.py` (每天早上8点运行)
    *   **注意**: `pj.py` (自动评教脚本) 通常在评教系统开放时按需运行，一般不建议设置过于频繁的定时任务。

## `pj.py` 运行结果示例

成功运行 `pj.py` 后，脚本将：

1. 显示登录状态。
2. 显示找到的评教批次信息。
3. 列出所有课程及其评教状态。
4. 识别未提交评教的课程。
5. 自动完成评教并提交。
6. 显示评教成功率（成功数/总数）。

## 文件说明

*   **`cjcx.py`**:
    *   用于登录教务系统，抓取最新的成绩单。
    *   比较新成绩与上次保存的成绩，如果发生变化，则通过 PushPlus 推送通知，并更新本地成绩记录文件。
*   **`jw.py`**:
    *   用于登录教务系统，抓取当前周的课程表。
    *   格式化课表信息，并在周一推送整周课表，其他工作日推送当日课表（如果当天有课）。
*   **`pj.py`**:
    *   用于自动登录教务系统，查找并完成所有未评价课程的教学评价。
*   **`kstx.py`**:
    *   用于登录教务系统，获取并分析考试安排信息。
    *   仅在检测到一周内有考试时，才通过 PushPlus 推送提醒。
    *   提供美观的HTML考试表格视图，突出显示即将到来的考试。
*   **`requirements.txt`**:
    *   包含所有项目依赖的Python库及其版本。
    *   通过 `pip install -r requirements.txt` 快速安装所有依赖。
*   **`previous_grades_data.json` (自动生成)**:
    *   由 `cjcx.py` 脚本生成，用于存储上一次成功获取的成绩数据，以便进行比较。
*   **`README.md`**:
    *   本项目说明文件。

## `pj.py` 脚本原理

`pj.py` 通过以下步骤完成自动评教：

1. 使用账号密码模拟登录教务系统。
2. 访问评教页面并获取评教链接。
3. 解析课程列表，提取课程信息。
4. 识别未提交评教的课程。
5. 对每个未评教课程，访问其评教页面。
6. 解析评教表单，提取所有需要选择的选项。
7. 为所有选择题选择"A"选项 (或预设的其他等级)。
8. 提交评教表单。
9. 验证评教是否成功提交。

## `kstx.py` 脚本原理与效果

`kstx.py` 通过以下步骤完成考试提醒：

1. 使用账号密码模拟登录教务系统。
2. 访问考试安排查询页面并获取学期选项。
3. 选择当前学期查询考试安排。
4. 解析HTML响应，提取考试信息。
5. 计算每门考试距离今天的天数。
6. 按日期排序并检查是否有近期考试。
7. 仅当存在一周内考试时，才执行以下步骤：
   - 生成美观的HTML表格。
   - 通过PushPlus服务推送到微信。

### 推送效果

脚本运行后，系统会首先检查是否有一周内的考试：

1. **当没有近期考试时**：控制台会显示"没有近期考试（一周内），无需推送微信提醒"，不会发送任何推送。

2. **当存在近期考试时**：您将收到一条包含以下内容的微信推送：
   - 标题显示当前学期名称和日期
   - 顶部显示本学期考试总数
   - 黄色区域特别提醒近期（7天内）考试
   - 主体部分是一个表格，包含所有考试的详细信息
   - 不同状态的考试使用不同背景色区分（已结束的考试为灰色，今天的考试为黄色，近期考试为浅黄色）

## 注意事项

1.  本系列脚本仅供学习和研究使用。
2.  使用前请确认您的账号密码及相关令牌设置正确。
3.  由于教务系统可能会更新，脚本可能需要相应调整。
4.  避免频繁运行脚本 (尤其是 `pj.py`)，以免对教务系统造成不必要的压力。
5.  请在学校规定的评教系统开放期间使用 `pj.py`。
6.  `pj.py` 默认所有评教题目均选择"A"选项。请根据实际情况和学校要求审慎使用。

## 故障排除

*   **登录失败**:
    *   检查您的 `JW_USERNAME` 和 `JW_PASSWORD` 环境变量或脚本内配置是否设置正确。
    *   确认教务系统没有更新登录机制或增加验证码等。
    *   检查网络连接是否正常。
*   **获取信息失败 (`cjcx.py`, `jw.py`, `pj.py`, `kstx.py`)**:
    *   可能是教务系统页面结构发生变化，导致 BeautifulSoup 解析失败。需要更新脚本中的解析逻辑。
    *   网络不稳定或请求超时。
*   **PushPlus 推送失败 (`cjcx.py`, `jw.py`, `kstx.py`)**:
    *   检查您的 `PUSH_TOKEN` 环境变量是否正确。
    *   确认 PushPlus 服务是否正常。
*   **`jw.py` 课表周次不正确**:
    *   请务必正确配置 `jw.py` 脚本中的 `first_week_monday` 变量。
*   **`pj.py` 评教失败或行为异常**:
    *   确认评教系统是否开放。
    *   教务系统评教页面的结构或流程可能已更改。
*   **`kstx.py` 没有推送考试提醒**:
    *   检查是否有一周内的考试安排；脚本只在有近期考试时才会推送。
    *   确认学期设置是否正确，可能需要选择不同的学期来查看考试安排。

## 贡献与改进

如果您想改进这些脚本，以下是一些可能的方向：

### `pj.py` 改进方向:
*   添加随机选择评教选项的功能或更灵活的等级配置。
*   添加图形用户界面。
*   实现多账号批量评教。
*   添加评教进度保存与恢复功能。
*   增加代理支持，避免IP限制。

### `kstx.py` 改进方向:
*   允许用户自定义近期考试的天数范围（目前固定为7天）。
*   增加考试倒计时提醒功能。
*   添加推送到其他平台的支持（如邮件、其他消息应用）。
*   实现考试安排自动导入到日历应用的功能。
*   优化推送内容的排版和样式。

## 免责声明

本系列脚本仅供学习和研究网络自动化技术使用，使用者应当遵守学校相关规定及适用法律法规。使用本脚本产生的任何后果由使用者自行承担，开发者不承担任何责任。

---

祝您使用愉快！
